<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Contact Lens Selector</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
  font-size: 10px;
  letter-spacing: 1px;
}

html, body {
  font-size: 10px;
  -webkit-text-size-adjust: none;
}

body { 
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  margin: 0;
  background: #f8f8f5;
  color: black;
}

h1 {
  font-size: 10px;
  text-align: center;
  margin-bottom: 12px;
}

h2 { 
  font-size: 10px;
  text-align: left;
  margin: 6px 0 8px;
  color: black;
}

.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 10px;
}

.wrap {
  width: 100%;
  min-width: 300px;
}

/* ========= Sections ========= */
.section {
  background: #E5F0D1;
  border: 0.5px solid #999;
  padding: 8px;
  margin: 8px 0;
}

.options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 6px 12px;
}

label {
  display: block;
}

input[type="checkbox"] {
  margin-right: 4px;
  accent-color: #5e3a87; /* purple accent */
}

/* ========= Summary Box ========= */
.summary {
  background: #f8f8f5;
  border: 0.5px solid #999;
  padding: 10px;
  font-size: 10px;
  margin: 12px 0;
  position: relative;
  top: auto;
  max-width: 100%;
}

.summary h2 {
  margin-top: 0;
}

.summary ul {  
  padding-left: 15px;
  margin: 0;
}

.desc {
  font-size: 10px;
  color: #333;
  margin: 4px 0 6px;
}

/* ========= Table ========= */
table { 
  width: 100%; 
  border-collapse: collapse; 
  margin-top: 10px; 
  font-size: 10px; 
  table-layout: auto;
}

table th, table td { 
  border: 0.5px solid #999; 
  padding: 6px 8px; 
  text-align: left; 
  min-width: 70px;
  white-space: normal;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

table th { 
  background: #E5F0D1;
  color: black;
  cursor: pointer;
}

/* ========= Buttons ========= */
button { 
  background: #5e3a87;   /* purple button */
  color: white; 
  border: 0.5px solid #333; 
  padding: 6px 12px; 
  cursor: pointer; 
  margin-top: 8px; 
}

button:disabled { background: #999; cursor: not-allowed; }
button:hover:not(:disabled) { background: #7c4dff; }

/* ========= Links ========= */
#results a {
  color: #101F01;
  text-decoration: none;
  font-weight: bold;
}

#results a:hover {
  color: #5e3a87;
  text-decoration: underline;
}

/* ========= Overlay ========= */
#overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #EDEADF;
  color: black;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  z-index: 9999;
}

/* ========= Optional Background Classes ========= */
.paleviolet { background: #D0C5DB; } /* soft purple */
.paleblue   { background: #BECEE8; }
.comfort    { background: #E5F0D1; }
.offwhite   { background: #f8f8f5; }

</style>
</head>
<body>



<!-- ðŸ”’ Locked screen -->
<div id="overlay">ðŸ”’ Entering password...</div>


<script>
  function checkPassword() {
    let password = "";
    const correctPassword = "kiara"; // change this

    while (password !== correctPassword) {
      password = prompt("Please enter password to use:");
      if (password === null) {
        document.getElementById("overlay").innerHTML = "Sorry, Access Denied.";
        return false;
      }
      if (password !== correctPassword) {
        alert("Wrong password. Try again.");
      }
    }
    return true;
  }

  window.onload = function () {
    if (checkPassword()) {
      document.getElementById("overlay").style.display = "none";
      document.getElementById("content").style.display = "block";
    }
  };
</script>









<div class="container">
  <div class="wrap">
    <h1>Welcome to Kiara Optometry Contact Lens Crawler</h1>

    <!-- Q1: Clear or Colour -->
    <div class="section">
      <h2>1. Clear or coloured lenses?</h2>
	<div class="options">
        <label><input type="checkbox" name="q1" value="CLEAR">Clear</label>
        <label><input type="checkbox" name="q1" value="COLOUR">Colour</label>

      </div>
    </div>

 <!-- Q2: Vision -->
    <div class="section">
      <h2>2. What type of prescription (RX)?</h2>
	<p class="desc">Short/far sighted has 1 set number, eg: -2.25.    Astigmatism has 3 set numbers, eg: -2.25/-1.25 x 90.<br>Multifocal has ADD, eg: -2.25 ADD +1.50.</p>
      <div class="options">
        <label><input type="checkbox" name="q3" value="SPH">Short or Far Sighted (SPH)</label>
        <label><input type="checkbox" name="q3" value="ASTIG"> With Astigmatism (ASTIG)</label>
        <label><input type="checkbox" name="q3" value="MF">Multi-focal (MF)</label>
      </div>
    </div>

    <!-- Q3: Modality -->
    <div class="section">
      <h2>3. What type of disposable?</h2>
      <div class="options">
        <label><input type="checkbox" name="q2" value="1 DAY">1 Day</label>
        <label><input type="checkbox" name="q2" value="2 WEEKS">2 Weeks</label>
        <label><input type="checkbox" name="q2" value="1 MONTH">1 Month</label>
        <label><input type="checkbox" name="q2" value="3 MONTHS">3 Months</label>
      </div>
    </div>

    <!-- Q4: Material -->
    <div class="section">
      <h2>4. Wearing long hours? Have red eyes? Feel tired?</h2>
      <div class="options">
        <label><input type="checkbox" name="q4" value="SIHY">High Oxygen Material (SiHy) - For long wearing hours, ie more than 8 hours</label>
        <label><input type="checkbox" name="q4" value="HY">Standard Oxygen Material (Hy) - For short wearing hours, ie less than 8 hours</label>
      </div>
    </div>

    <!-- Q5: Standard / Premium -->
    <div class="section">
      <h2>5. Do you need lenses with advanced technology?</h2>
      <div class="options">
        <label><input type="checkbox" name="q5" value="PREMIUM">Advanced Comfort & Performance</label>
	<label><input type="checkbox" name="q5" value="STANDARD">Standard Comfort Design</label>
      </div>
    </div>

Search CYL RX product, type this format: S-5.00 C-1.25 x180

<div>
  <button id="showBtn" disabled>Loading...</button>
  <span id="btnText" style="margin-left:10px"></span>
</div>

<div style="display:flex; gap:4%; margin:12px 0;">
  <input type="text" id="searchRE" placeholder="Search Bar Right"
         style="flex:1; padding:6px; font-size:10px;">
  <input type="text" id="searchLE" placeholder="Search Bar Left (Use if needed)"
         style="flex:1; padding:6px; font-size:10px;">
</div>


<div class="results" id="results"></div>



  
</div>



<script>
const csvUrl = 'https://raw.githubusercontent.com/kiaraoptometrypx/CL-SELECTOR/main/CL%20DATABASE.csv';
let products = [];
const button = document.getElementById('showBtn');

// Fetch CSV
fetch(csvUrl)
  .then(res => res.text())
  .then(text => {
    const rows = text.trim().split('\n').map(r => r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
    const headers = rows[0].map(h => h.replace(/^"|"$/g,'').trim());

    products = rows.slice(1).map(r => {
      let obj = {};
      r.forEach((val,i) => {
        const key = headers[i].replace(/^"|"$/g,'').trim();
        obj[key] = val.replace(/^"|"$/g,'').trim();
      });
      return obj;
    });

    console.log(products[0]); // debug first row
    button.disabled = false;
    button.textContent = 'Show Results';
  })
  .catch(err => console.error('CSV Load Error:', err));

// Update summary
document.querySelectorAll("input[type=checkbox]").forEach(input => {
  input.addEventListener("change", () => {
    const list = document.getElementById("summaryList");
    const checked = document.querySelectorAll("input[type=checkbox]:checked");
    list.innerHTML = checked.length ? '' : '<li>No selections yet</li>';
    checked.forEach(c => list.appendChild(Object.assign(document.createElement('li'), {textContent: c.parentElement.textContent.trim()})));
  });
});

// Show results
function showResults() {
  // Collect all selected checkboxes
  const selected = {q1:[], q2:[], q3:[], q4:[], q5:[]};
  document.querySelectorAll("input[type=checkbox]:checked").forEach(c => {
    selected[c.name].push(c.value.toUpperCase());
  });

  // Get the search queries
  const reInput = document.getElementById("searchRE").value.trim().toLowerCase();
  let leInput = document.getElementById("searchLE").value.trim().toLowerCase();

  // If LE is empty, copy RE
  if (!leInput) leInput = reInput;

  // Filter products by checkboxes and fuzzy search
  function filterProducts(query) {
    return products.filter(p => {
      const q1Col = "LENS TYPE (CLEAR, COLOUR)";   
      const mCol = "MODALITY (1 DAY, 2 WEEKS, 1 MONTH, 3 MONTHS)";
      const vCol = "VISION (SPH, ASTIG, MF)";
      const matCol = "MATERIAL (SIHY, HY)";
      const gCol = "GRADE (PREMIUM, STANDARD)";

      const lensType = p[q1Col]?.trim().toUpperCase();
      const modality = p[mCol]?.trim().toUpperCase();
      const vision = p[vCol]?.trim().toUpperCase();
      const material = p[matCol]?.trim().toUpperCase();
      const grade = p[gCol]?.trim().toUpperCase();

      // Filter by selections
      if (selected.q1.length && !selected.q1.includes(lensType)) return false;
      if (selected.q2.length && !selected.q2.includes(modality)) return false;
      if (selected.q3.length && !selected.q3.includes(vision)) return false;
      if (selected.q4.length && !selected.q4.includes(material)) return false;
      if (selected.q5.length && !selected.q5.includes(grade)) return false;

      // Fuzzy search
      if (query) {
        const rowText = Object.values(p).join(" ").toLowerCase();
        const terms = query.split(/\s+/).filter(Boolean);
        if (!terms.every(t => rowText.includes(t))) return false;
      }

      return true;
    });
  }

  // Filter each eye
  const reFiltered = filterProducts(reInput);
  const leFiltered = filterProducts(leInput);

  // Keep only products that exist in BOTH results (overlap)
  const overlapping = reFiltered.filter(p1 =>
      leFiltered.some(p2 => p2["FULL NAME"] === p1["FULL NAME"])
  );

  renderTable(overlapping);
}


// Run search when pressing Enter
document.getElementById("searchRE").addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();
    showResults();
  }
});

document.getElementById("searchLE").addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();
    showResults();
  }
});

// Render table
function renderTable(data) {
  const container = document.getElementById("results");
  if (!data.length) { 
    container.innerHTML = "<p>No matching products found.</p>"; 
    return; 
  }

  // Keep only first occurrence of each FULL NAME
  const seen = new Set();
  data = data.filter(p => {
    if (seen.has(p["FULL NAME"])) return false;
    seen.add(p["FULL NAME"]);
    return true;
  });

  const headers = ["FULL NAME","MODALITY (1 DAY, 2 WEEKS, 1 MONTH, 3 MONTHS)","1 BOX PRICE & UNIT","COMFORT & MATERIAL"];
  const headerMap = {
    "FULL NAME": "Product (Click on product to see image)",
    "MODALITY (1 DAY, 2 WEEKS, 1 MONTH, 3 MONTHS)": "Dispose Period",
    "1 BOX PRICE & UNIT": "Price Per Pack & Qty",
    "COMFORT & MATERIAL": "Comfort & Material",
  };

  let table = "<table><thead><tr>" + headers.map(h => `<th onclick="sortTable(this)">${headerMap[h]}</th>`).join('') + "</tr></thead><tbody>";

  data.forEach(p => {
    table += "<tr>" + headers.map(h => {
      if (h === "FULL NAME") {
        return `<td><a href="#" onclick="toggleImage(this,'${p['PHOTO']}','${p[h]}'); return false;">${p[h]}</a></td>`;
      }
      return `<td>${p[h]}</td>`;
    }).join('') + "</tr>";
  });

  table += "</tbody></table>";
  container.innerHTML = table;
}

// Toggle image under row
function toggleImage(link, photo, name) {
  const row = link.closest("tr");
  const nextRow = row.nextElementSibling;

  // If next row is already the image, remove it
  if (nextRow && nextRow.classList.contains("imageRow")) {
    nextRow.remove();
    return;
  }

// Otherwise, insert image row
const imgRow = document.createElement("tr");
imgRow.classList.add("imageRow");
imgRow.innerHTML = `<td colspan="4" style="text-align:center;">
                      <h3>${name}</h3>
                      <img src="https://raw.githubusercontent.com/kiaraoptometrypx/CL-SELECTOR/main/CL-PHOTOS/${photo}.png" 
                           alt="${name}" 
                           style="width:100%; max-width:400px; height:auto; border:1px solid #ccc; border-radius:6px; margin-top:10px;">
                    </td>`;
row.parentNode.insertBefore(imgRow, row.nextSibling);

}

// Sort table
function sortTable(header) {
  const table = header.closest("table");
  const index = [...header.parentNode.children].indexOf(header);
  const rows = [...table.tBodies[0].rows];
  const asc = !header.asc;
  rows.sort((a,b) => a.cells[index].innerText.localeCompare(b.cells[index].innerText, undefined, {numeric:true}) * (asc ? 1 : -1));
  rows.forEach(r => table.tBodies[0].appendChild(r));
  header.asc = asc;
}

// Attach button
button.addEventListener("click", showResults);
</script>



<!-- Spacer at the bottom for scrolling -->
<div style="height:400px;"></div>




</body>
</html>
