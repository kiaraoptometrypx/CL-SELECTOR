<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Contact Lens Selector</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>


/* ========= Base ========= */
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  font-size: 12px;
  line-height: 1.3;
  margin: 0;
  background: #f8f8f5;
  color: #0b3d2e;
}

h1 {
  font-size: 14px;
  text-align: center;
  margin-bottom: 12px;
}

h2 {
  font-size: 13px;
  margin: 6px 0 8px;
}

/* ========= Layout ========= */
.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 10px;
}

.wrap {
  width: 100%;
  min-width: 300px;
}

/* ========= Sections ========= */
.section {
  background: #ffffe0;
  border: 1px solid #d7d7cf;
  border-radius: 6px;
  padding: 8px;
  margin: 8px 0;
}

.options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px 12px;
}

label {
  display: block;
}

input[type="checkbox"] {
  margin-right: 4px;
}

/* ========= Summary Box ========= */
.summary {
  background: #ffffe0;
  border: 1px solid #d7d7cf;
  border-radius: 6px;
  padding: 10px;
  font-size: 12px;
  margin: 12px 0;     /* space above/below */
  position: relative;
  top: auto;
  max-width: 100%;
}

.summary h2 {
  margin-top: 0;
}

.summary ul {  
  padding-left: 15px;
  margin: 0;
}

.desc {
  font-size: 12px;
  color: #0b3d2e;
  margin: 4px 0 6px;
}

table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 11px; }
table th, table td { 
  border: 1px solid #ccc; 
  padding: 6px 8px; /* a little more padding for readability */
  text-align: left; 
  min-width: 70px;  /* makes all columns wider */
  white-space: normal;
  word-wrap: break-word;
}


table th { background: #e6e6d6; cursor: pointer; }
button { background: #0b3d2e; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; margin-top: 8px; }
button:disabled { background: #999; cursor: not-allowed; }
button:hover:not(:disabled) { background: #095c42; }
@media (max-width: 600px) { .container { flex-direction: column; } .summary { position: relative; top: 0; margin-top: 10px; } 
}

/* Product links (inside table) */
#results a {
  color: #0b3d2e;      /* same dark green as your theme */
  text-decoration: none;
  font-weight: 400;
}

#results a:hover {
  color: #095c42;       /* slightly brighter on hover */
  text-decoration: underline;
}


</style>
</head>
<body>













<div class="container">
  <div class="wrap">
    <h1>Contact Lens Selector</h1>

    <!-- Q1: Clear or Colour -->
    <div class="section">
      <h2>1. Clear or coloured lenses?</h2>
	<p class="desc">---</p>
      <div class="options">
        <label><input type="checkbox" name="q1" value="CLEAR">Clear</label>
        <label><input type="checkbox" name="q1" value="COLOUR">Colour</label>

      </div>
    </div>


    <!-- Q2: Modality -->
    <div class="section">
      <h2>2. What type of disposable?</h2>
	<p class="desc">When do you plan to replace them?<br>---</p>
      <div class="options">
        <label><input type="checkbox" name="q2" value="1 DAY">1 Day</label>
        <label><input type="checkbox" name="q2" value="2 WEEKS">2 Weeks</label>
        <label><input type="checkbox" name="q2" value="1 MONTH">1 Month</label>
        <label><input type="checkbox" name="q2" value="3 MONTHS">3 Months</label>
      </div>
    </div>

    <!-- Q3: Vision -->
    <div class="section">
      <h2>3. What type of prescription (RX)?</h2>
	<p class="desc">Short or far sighted RX are short. ( eg: -2.25 )<br>Astigmatism RX has 3 numbers. ( eg: -2.25/-1.25 x 90 )<br>Multifocals RX has ADD. ( eg: -2.25 ADD +1.50 )<br>---</p>
      <div class="options">
        <label><input type="checkbox" name="q3" value="SPH">Short or Far Sighted (SPH)</label>
        <label><input type="checkbox" name="q3" value="ASTIG"> With Astigmatism (ASTIG)</label>
        <label><input type="checkbox" name="q3" value="MF">Multi-focal (MF)</label>
      </div>
    </div>

    <!-- Q4: Material -->
    <div class="section">
      <h2>4. How many hours of wear?</h2>
	<p class="desc">Premium materials reduce red and tired eyes.<br>--- </p>
      <div class="options">
        <label><input type="checkbox" name="q4" value="SIHY">Silicone Hydrogel for more than 8 Hours</label>
        <label><input type="checkbox" name="q4" value="HY">Hydrogel for less than 8 hours</label>
      </div>
    </div>

    <!-- Q5: Standard / Premium -->
    <div class="section">
      <h2>5. Do you want something for sensitive eyes?</h2>
	<p class="desc">Premium designs have enhanced comfort from advanced coating and material.<br>--- </p>
      <div class="options">
        <label><input type="checkbox" name="q5" value="PREMIUM">Premium Design</label>
	<label><input type="checkbox" name="q5" value="STANDARD">Standard Design</label>
      </div>
    </div>


    <div class="summary">
    <h2>Your Selections</h2>
    <ul id="summaryList"><li>No selections yet</li></ul>
    </div>




    <button id="showBtn" disabled>Loading...</button>
<input type="text" id="searchBox" placeholder="Refine search, fuzzy logic.." 
       style="width:100%;padding:6px;margin:12px 0;font-size:12px;">


<div class="results" id="results"></div>


  
</div>



<script>
const csvUrl = 'https://raw.githubusercontent.com/kiaraoptometrypx/CL-SELECTOR/main/CL%20DATABASE.csv';
let products = [];
const button = document.getElementById('showBtn');

// Fetch CSV
fetch(csvUrl)
  .then(res => res.text())
  .then(text => {
    const rows = text.trim().split('\n').map(r => r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
    const headers = rows[0].map(h => h.replace(/^"|"$/g,'').trim());

    products = rows.slice(1).map(r => {
      let obj = {};
      r.forEach((val,i) => {
        const key = headers[i].replace(/^"|"$/g,'').trim();
        obj[key] = val.replace(/^"|"$/g,'').trim();
      });
      return obj;
    });

    console.log(products[0]); // debug first row
    button.disabled = false;
    button.textContent = 'Show Results';
  })
  .catch(err => console.error('CSV Load Error:', err));

// Update summary
document.querySelectorAll("input[type=checkbox]").forEach(input => {
  input.addEventListener("change", () => {
    const list = document.getElementById("summaryList");
    const checked = document.querySelectorAll("input[type=checkbox]:checked");
    list.innerHTML = checked.length ? '' : '<li>No selections yet</li>';
    checked.forEach(c => list.appendChild(Object.assign(document.createElement('li'), {textContent: c.parentElement.textContent.trim()})));
  });
});

// Show results (updated to include Q1)
function showResults() {
  // Collect all selected checkboxes
  const selected = {q1:[], q2:[], q3:[], q4:[], q5:[]};
  document.querySelectorAll("input[type=checkbox]:checked").forEach(c => {
    selected[c.name].push(c.value.toUpperCase());
  });

  // Get the search query
  const query = document.getElementById("searchBox").value.trim().toLowerCase();

  // Filter products
  const filtered = products.filter(p => {
    const q1Col = "LENS TYPE (CLEAR, COLOUR)";   
    const mCol = "MODALITY (1 DAY, 2 WEEKS, 1 MONTH, 3 MONTHS)";
    const vCol = "VISION (SPH, ASTIG, MF)";
    const matCol = "MATERIAL (SIHY, HY)";
    const gCol = "GRADE (PREMIUM, STANDARD)";

    const lensType = p[q1Col]?.trim().toUpperCase();
    const modality = p[mCol]?.trim().toUpperCase();
    const vision = p[vCol]?.trim().toUpperCase();
    const material = p[matCol]?.trim().toUpperCase();
    const grade = p[gCol]?.trim().toUpperCase();

    // Filter by selections
    if (selected.q1.length && !selected.q1.includes(lensType)) return false;
    if (selected.q2.length && !selected.q2.includes(modality)) return false;
    if (selected.q3.length && !selected.q3.includes(vision)) return false;
    if (selected.q4.length && !selected.q4.includes(material)) return false;
    if (selected.q5.length && !selected.q5.includes(grade)) return false;

    // Fuzzy search
    if (query) {
      const rowText = Object.values(p).join(" ").toLowerCase();
      const terms = query.split(/\s+/).filter(Boolean);
      if (!terms.every(t => rowText.includes(t))) return false;
    }

    return true;
  });

  renderTable(filtered);
}

// Run search when pressing Enter
document.getElementById("searchBox").addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();
    showResults();
  }
});

// Render table
function renderTable(data) {
  const container = document.getElementById("results");
  if (!data.length) { 
    container.innerHTML = "<p>No matching products found.</p>"; 
    return; 
  }

  const headers = ["FULL NAME","1 BOX PRICE & UNIT","COMFORT & MATERIAL"];
  const headerMap = {
    "FULL NAME": "Product (Click on product to see image)",
    "1 BOX PRICE & UNIT": "Price Per Pack & Qty",
    "COMFORT & MATERIAL": "Material & Surface",
  };

  let table = "<table><thead><tr>" + headers.map(h => `<th onclick="sortTable(this)">${headerMap[h]}</th>`).join('') + "</tr></thead><tbody>";

  data.forEach(p => {
    table += "<tr>" + headers.map(h => {
      if (h === "FULL NAME") {
        return `<td><a href="#" onclick="toggleImage(this,'${p['PHOTO']}','${p[h]}'); return false;">${p[h]}</a></td>`;
      }
      return `<td>${p[h]}</td>`;
    }).join('') + "</tr>";
  });

  table += "</tbody></table>";
  container.innerHTML = table;
}

// Toggle image under row
function toggleImage(link, photo, name) {
  const row = link.closest("tr");
  const nextRow = row.nextElementSibling;

  // If next row is already the image, remove it
  if (nextRow && nextRow.classList.contains("imageRow")) {
    nextRow.remove();
    return;
  }

  // Otherwise, insert image row
  const imgRow = document.createElement("tr");
  imgRow.classList.add("imageRow");
  imgRow.innerHTML = `<td colspan="3" style="text-align:center;">
                        <h3>${name}</h3>
                        <img src="https://raw.githubusercontent.com/kiaraoptometrypx/CL-SELECTOR/main/CL-PHOTOS/${photo}.png" 
                             alt="${name}" 
                             style="width:300px; height:auto; border:1px solid #ccc; border-radius:6px; margin-top:10px;">
                      </td>`;
  row.parentNode.insertBefore(imgRow, row.nextSibling);
}

// Sort table
function sortTable(header) {
  const table = header.closest("table");
  const index = [...header.parentNode.children].indexOf(header);
  const rows = [...table.tBodies[0].rows];
  const asc = !header.asc;
  rows.sort((a,b) => a.cells[index].innerText.localeCompare(b.cells[index].innerText, undefined, {numeric:true}) * (asc ? 1 : -1));
  rows.forEach(r => table.tBodies[0].appendChild(r));
  header.asc = asc;
}

// Attach button
button.addEventListener("click", showResults);
</script>



<!-- Spacer at the bottom for scrolling -->
<div style="height:400px;"></div>




</body>
</html>
